<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PMS Bot</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    #chat-box { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: scroll; margin-bottom: 10px; }
    .user { color: blue; }
    .bot { color: green; }
    #controls { margin-top: 10px; }
    button { margin-left: 5px; padding: 6px 12px; }
  </style>
</head>
<body>
  <h2>üí¨ PMS Bot</h2>
  <div><b>Session ID:</b> <span id="session-display">None</span></div>
  <div id="chat-box"></div>

  <div id="controls">
    <input type="text" id="user-input" placeholder="Type your question..." style="width: 70%;">
    <button onclick="sendMessage()">Send</button>
    <button onclick="startNewChat()">‚ûï Start New Chat</button>
  </div>

  <script>
    let sessionId = null;
  
    async function sendMessage() {
      const inputBox = document.getElementById("user-input");
      const userMessage = inputBox.value.trim();
      if (!userMessage) return;
  
      // Display user message
      const chatBox = document.getElementById("chat-box");
      chatBox.innerHTML += `<div class="user"><b>You:</b> ${userMessage}</div>`;
  
      try {
        // Call backend
        const response = await fetch("http://127.0.0.1:8000/chat", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            session_id: sessionId,
            user_input: userMessage
          })
        });
  
        const data = await response.json();
  
        // Save session ID (so chat continues in same session)
        sessionId = data.session_id;
        document.getElementById("session-display").innerText = sessionId;
  
        // Display bot response
        let botMessage = `<div class="bot"><b>Bot:</b> ${data.response}</div>`;
  
        // ‚úÖ If a chart is available, show it
        if (data.chart_url) {
          const fullUrl = `http://127.0.0.1:8000${data.chart_url}`;
          botMessage += `<div class="bot"><img src="${fullUrl}" alt="Generated Chart" style="max-width: 100%; margin-top: 10px; border:1px solid #ccc; border-radius: 6px;"></div>`;
        }
  
        chatBox.innerHTML += botMessage;
        chatBox.scrollTop = chatBox.scrollHeight;
  
      } catch (err) {
        console.error("Error:", err);
        chatBox.innerHTML += `<div class="bot"><b>Bot:</b> ‚ùå Error connecting to server.</div>`;
      }
  
      inputBox.value = "";
    }
  
    function startNewChat() {
      // Reset chat and session
      sessionId = null;
      document.getElementById("session-display").innerText = "None";
      document.getElementById("chat-box").innerHTML = "";
    }
  </script>
  
</body>
</html>
